{"version":3,"file":"fs-files-format-1f49ba46.mjs","sources":["../src/uploader/components/fs-files-format.vue","../src/uploader/components/fs-files-format.vue"],"sourcesContent":["<template>\n  <div class=\"fs-files-format\">\n    <template v-if=\"type === 'text'\">\n      <span v-for=\"item in itemsRef\" :key=\"item.url\" class=\"fs-files-item\">\n        <a :href=\"item.url\" target=\"_blank\" v-bind=\"a\">\n          {{ item.name }}\n        </a>\n      </span>\n    </template>\n    <template v-else>\n      <component\n        :is=\"ui.tag.name\"\n        v-for=\"item in itemsRef\"\n        :key=\"item.url\"\n        class=\"fs-tag-item\"\n        :type=\"item.color\"\n        v-bind=\"tag\"\n      >\n        <a :href=\"item.url\" target=\"_blank\" v-bind=\"a\">{{ item.name }}</a>\n      </component>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, Ref, ref, watch } from \"vue\";\nimport { useUi } from \"@fast-crud/fast-crud\";\n/**\n * 文件格式化展示组件\n */\nexport default defineComponent({\n  name: \"FsFilesFormat\",\n  props: {\n    /**\n     * 文件列表\n     * 支持格式： `url , {url} , [url1,url2] ,  [{url:url1},{url:url2}]`\n     */\n    modelValue: {},\n    // tag颜色，`【primary, success, warning, danger ,info】`\n    color: {\n      default: \"\"\n    },\n    // 展示类型`【text, tag】`\n    type: {\n      default: \"tag\" // `可选【text,tag】`\n    },\n    // 链接配置\n    a: {},\n    // tag配置\n    tag: {},\n    // 构建下载url方法，支持异步\n    buildUrl: {},\n    // 批量构建下载url方法，支持异步\n    buildUrls: {},\n    // 根据value构建文件名\n    getFileName: {}\n  } as any,\n  setup(props: any, ctx) {\n    const { ui } = useUi();\n    const getFileName = computed(() => {\n      return (\n        props.getFileName ||\n        function (url: any) {\n          if (typeof url !== \"string\") {\n            console.warn(\"获取文件名失败，请配置getFileName\");\n            return url;\n          }\n          if (url?.lastIndexOf(\"/\") >= 0) {\n            return url.substring(url.lastIndexOf(\"/\") + 1);\n          }\n          return url;\n        }\n      );\n    });\n    function getItem(value: any): any {\n      return {\n        url: undefined,\n        value: value,\n        name: getFileName.value(value),\n        color: props.color\n      };\n    }\n\n    async function buildFileListUrls(list: any[]) {\n      if (props.buildUrls) {\n        const values = list.map((item) => item.value);\n        const urls = await props.buildUrls(values);\n        for (let i = 0; i < list.length; i++) {\n          list[i].url = urls[i];\n        }\n      } else if (props.buildUrl) {\n        for (let item of list) {\n          item.url = await props.buildUrl(item.value);\n        }\n      } else {\n        for (let i = 0; i < list.length; i++) {\n          list[i].url = list[i].value;\n        }\n      }\n    }\n\n    async function buildItems() {\n      if (props.modelValue == null || props.modelValue === \"\") {\n        return [];\n      }\n      let valueArr = [];\n      if (typeof props.modelValue === \"string\") {\n        valueArr = [getItem(props.modelValue)];\n      } else if (props.modelValue instanceof Array) {\n        // 本来就是数组的\n        valueArr = [];\n        for (const val of props.modelValue) {\n          valueArr.push(getItem(val));\n        }\n      }\n      await buildFileListUrls(valueArr);\n      return valueArr;\n    }\n    const itemsRef: Ref = ref([]);\n    watch(\n      () => {\n        return props.modelValue;\n      },\n      async () => {\n        itemsRef.value = await buildItems();\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      ui,\n      itemsRef\n    };\n  }\n});\n</script>\n<style lang=\"less\">\n.fs-files-format {\n  display: flex;\n  flex-wrap: wrap;\n  .fs-form-item,\n  .fs-tag-item {\n    margin: 1px;\n    a {\n      text-decoration: none;\n    }\n  }\n  .tag-item {\n    margin-right: 10px;\n  }\n  .el-divider__text,\n  .el-link {\n    font-size: inherit;\n  }\n}\n</style>\n","<template>\n  <div class=\"fs-files-format\">\n    <template v-if=\"type === 'text'\">\n      <span v-for=\"item in itemsRef\" :key=\"item.url\" class=\"fs-files-item\">\n        <a :href=\"item.url\" target=\"_blank\" v-bind=\"a\">\n          {{ item.name }}\n        </a>\n      </span>\n    </template>\n    <template v-else>\n      <component\n        :is=\"ui.tag.name\"\n        v-for=\"item in itemsRef\"\n        :key=\"item.url\"\n        class=\"fs-tag-item\"\n        :type=\"item.color\"\n        v-bind=\"tag\"\n      >\n        <a :href=\"item.url\" target=\"_blank\" v-bind=\"a\">{{ item.name }}</a>\n      </component>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, Ref, ref, watch } from \"vue\";\nimport { useUi } from \"@fast-crud/fast-crud\";\n/**\n * 文件格式化展示组件\n */\nexport default defineComponent({\n  name: \"FsFilesFormat\",\n  props: {\n    /**\n     * 文件列表\n     * 支持格式： `url , {url} , [url1,url2] ,  [{url:url1},{url:url2}]`\n     */\n    modelValue: {},\n    // tag颜色，`【primary, success, warning, danger ,info】`\n    color: {\n      default: \"\"\n    },\n    // 展示类型`【text, tag】`\n    type: {\n      default: \"tag\" // `可选【text,tag】`\n    },\n    // 链接配置\n    a: {},\n    // tag配置\n    tag: {},\n    // 构建下载url方法，支持异步\n    buildUrl: {},\n    // 批量构建下载url方法，支持异步\n    buildUrls: {},\n    // 根据value构建文件名\n    getFileName: {}\n  } as any,\n  setup(props: any, ctx) {\n    const { ui } = useUi();\n    const getFileName = computed(() => {\n      return (\n        props.getFileName ||\n        function (url: any) {\n          if (typeof url !== \"string\") {\n            console.warn(\"获取文件名失败，请配置getFileName\");\n            return url;\n          }\n          if (url?.lastIndexOf(\"/\") >= 0) {\n            return url.substring(url.lastIndexOf(\"/\") + 1);\n          }\n          return url;\n        }\n      );\n    });\n    function getItem(value: any): any {\n      return {\n        url: undefined,\n        value: value,\n        name: getFileName.value(value),\n        color: props.color\n      };\n    }\n\n    async function buildFileListUrls(list: any[]) {\n      if (props.buildUrls) {\n        const values = list.map((item) => item.value);\n        const urls = await props.buildUrls(values);\n        for (let i = 0; i < list.length; i++) {\n          list[i].url = urls[i];\n        }\n      } else if (props.buildUrl) {\n        for (let item of list) {\n          item.url = await props.buildUrl(item.value);\n        }\n      } else {\n        for (let i = 0; i < list.length; i++) {\n          list[i].url = list[i].value;\n        }\n      }\n    }\n\n    async function buildItems() {\n      if (props.modelValue == null || props.modelValue === \"\") {\n        return [];\n      }\n      let valueArr = [];\n      if (typeof props.modelValue === \"string\") {\n        valueArr = [getItem(props.modelValue)];\n      } else if (props.modelValue instanceof Array) {\n        // 本来就是数组的\n        valueArr = [];\n        for (const val of props.modelValue) {\n          valueArr.push(getItem(val));\n        }\n      }\n      await buildFileListUrls(valueArr);\n      return valueArr;\n    }\n    const itemsRef: Ref = ref([]);\n    watch(\n      () => {\n        return props.modelValue;\n      },\n      async () => {\n        itemsRef.value = await buildItems();\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      ui,\n      itemsRef\n    };\n  }\n});\n</script>\n<style lang=\"less\">\n.fs-files-format {\n  display: flex;\n  flex-wrap: wrap;\n  .fs-form-item,\n  .fs-tag-item {\n    margin: 1px;\n    a {\n      text-decoration: none;\n    }\n  }\n  .tag-item {\n    margin-right: 10px;\n  }\n  .el-divider__text,\n  .el-link {\n    font-size: inherit;\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","props","ctx","ui","useUi","getFileName","computed","url","getItem","value","buildFileListUrls","list","values","item","urls","i","buildItems","valueArr","val","itemsRef","ref","watch","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_hoisted_1","_openBlock","_createElementBlock","_Fragment","_renderList","_createElementVNode","_mergeProps","_createBlock","_resolveDynamicComponent","_withCtx"],"mappings":"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"}